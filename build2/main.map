{"version":3,"sources":["webpack:///webpack/bootstrap eeab15a4cb138faa2fff","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///(webpack)/buildin/harmony-module.js","webpack:///external \"dotenv\"","webpack:///external \"koa-passport\"","webpack:///./server/models/index.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///external \"koa-router\"","webpack:///./server/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./nuxt.config.js","webpack:///external \"koa-session\"","webpack:///external \"koa-bodyparser\"","webpack:///./server/lib/passport.js","webpack:///external \"sequelize\"","webpack:///./server/models","webpack:///external \"passport-github\"","webpack:///./server/lib/api.js","webpack:///./server/lib"],"names":["require","config","fs","path","Sequelize","env","params","Object","assign","underscored","dialectOptions","ssl","define","timestamps","createdAt","updatedAt","sequelize","url","database","username","password","db","readdirSync","__dirname","filter","file","indexOf","forEach","model","import","join","name","keys","modelName","associate","module","exports","app","host","process","HOST","port","PORT","dev","nuxt","builder","build","catch","console","error","e","exit","use","ctx","next","start","Date","ms","log","method","status","Promise","resolve","reject","res","on","render","req","promise","then","passport","initialize","session","router","get","authenticate","successRedirect","failureRedirect","routes","isAuthenticated","request","message","redirect","models","sync","listen","err","Error","head","title","meta","charset","content","hid","link","rel","type","href","css","loading","color","plugins","serializeUser","user","done","id","deserializeUser","users","findById","GitHubStrategy","Strategy","clientID","GITHUB_CLIENT_ID","clientSecret","GITHUB_CLIENT_SECRET","callbackURL","GITHUB_CLIENT_CALLBACK_URL","accessToken","refreshToken","profile","cb","_json","email","avatar_url","findOrCreate","where","github_id","defaults","avatar","spread","created","KoaRouter","apiRouter","prefix","controllerPath","controllerClass","controller","logout","body"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap eeab15a4cb138faa2fff","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = function(originalModule) {\r\n\tif(!originalModule.webpackPolyfill) {\r\n\t\tvar module = Object.create(originalModule);\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"exports\", {\r\n\t\t\tenumerable: true,\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/harmony-module.js\n// module id = 1\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"koa-passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-passport\"\n// module id = 3\n// module chunks = 0","require('dotenv').config();\nconst fs        = require(\"fs\");\nconst path      = require(\"path\");\nconst Sequelize = require('sequelize');\nconst env       = process.env.NODE_ENV || \"development\";\nconst config    = require(path.join(__dirname, '../../', 'config', 'db.js'))[env];\n\nconst params = Object.assign({\n  // 字段以下划线（_）来分割\n  underscored: true,\n  dialectOptions: {\n    ssl: false\n  },\n  define: {\n    timestamps: true,\n    createdAt: 'create_at',\n    updatedAt: 'update_at'\n  },\n  // logging: false\n}, config);\n\nlet sequelize\n\nif (config.url) {\n  sequelize = new Sequelize(config.url, params);\n} else {\n  sequelize = new Sequelize(config.database, config.username, config.password, params);\n}\n\nlet db = {};\n\nfs\n  .readdirSync(__dirname)\n  .filter(function(file) {\n    return (file.indexOf(\".\") !== 0) && (file !== \"index.js\");\n  })\n  .forEach(function(file) {\n    var model = sequelize.import(path.join(__dirname, file));\n    db[model.name] = model;\n  });\n\nObject.keys(db).forEach(function(modelName) {\n  if (\"associate\" in db[modelName]) {\n    db[modelName].associate(db);\n  }\n});\n\ndb.sequelize = sequelize;\ndb.Sequelize = Sequelize;\n\nmodule.exports = db;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 7\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\n\nconst app = new Koa()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\n\n// Import and Set Nuxt.js options\nlet config = require('../nuxt.config.js')\nconfig.dev = !(app.env === 'production')\n\n// Instantiate nuxt.js\nconst nuxt = new Nuxt(config)\n\n// Build in development\nif (config.dev) {\n  const builder = new Builder(nuxt)\n  builder.build().catch(e => {\n    console.error(e) // eslint-disable-line no-console\n    process.exit(1)\n  })\n  // for dev log\n  app.use(async (ctx, next) => {\n    const start = new Date();\n    await next();\n    const ms = new Date() - start;\n    console.log(`${ctx.method} ${ctx.url} - ${ms}ms`);\n  });\n}\n\napp.use(ctx => {\n  ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n\n  return new Promise((resolve, reject) => {\n    ctx.res.on('close', resolve)\n    ctx.res.on('finish', resolve)\n    nuxt.render(ctx.req, ctx.res, promise => {\n      // nuxt.render passes a rejected promise into callback on error.\n      promise.then(resolve).catch(reject)\n    })\n  })\n})\n\napp.keys = ['i-love-piper']\napp.use(require('koa-session')({}, app))\n\napp.use(require('koa-bodyparser')());\n// app.use(require('./lib/errorlog'));\n\n// authentication\nrequire('./lib/passport')\nconst passport = require('koa-passport')\napp.use(passport.initialize())\napp.use(passport.session())\n\nconst router = require('koa-router')()\n\nrouter.get('/auth/github',\n  passport.authenticate('github')\n)\n\nrouter.get('/auth/github/callback',\n  passport.authenticate('github', {\n    successRedirect: '/',\n    failureRedirect: '/'\n  })\n)\n\napp.use(router.routes())\n\napp.use(require('./lib/api'));\n\n// Require authentication for now\napp.use(function(ctx, next) {\n  if (ctx.isAuthenticated()) {\n    return next()\n  } else {\n    if (ctx.request.url.indexOf('/api/') !== -1) {\n      throw {\n        status: 401,\n        name: 'NOT_LOGIN',\n        message: 'not login'\n      }\n    } else {\n      ctx.redirect('/')\n    }\n  }\n})\n\nconst models = require('./models')\nmodels.sequelize.sync().then(function(){\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}).catch(function(err){\n  console.error(new Error(err))\n});\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 11\n// module chunks = 0","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'Piper',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'A drag-and-drop mobile website builder base on Vue.' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: [],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n  ** Build\n  */\n  build: {},\n  plugins: [\n    '~/plugins/filters.js',\n    '~/plugins/element-ui.js'\n  ]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 14\n// module chunks = 0","require('dotenv').config()\nconst passport = require('koa-passport')\nconst models = require('../models')\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id)\n})\n\npassport.deserializeUser(async function(id, done) {\n  try {\n    const user = await models.users.findById(id)\n    done(null, user)\n  } catch(err) {\n    done(err)\n  }\n})\n\nconst GitHubStrategy = require('passport-github').Strategy;\npassport.use(new GitHubStrategy({\n    clientID: process.env.GITHUB_CLIENT_ID,\n    clientSecret: process.env.GITHUB_CLIENT_SECRET,\n    callbackURL: process.env.GITHUB_CLIENT_CALLBACK_URL\n  },\n  function(accessToken, refreshToken, profile, cb) {\n    let {\n      name,\n      email,\n      id,\n      avatar_url\n    } = profile._json;\n    models.users.findOrCreate({where: {github_id: id}, defaults: {\n      name: name,\n      email: email,\n      avatar: avatar_url\n    }}).spread((user, created) => cb(null, user)).catch(err => {\n      console.log(err)\n    })\n  }\n));\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/passport.js","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 17\n// module chunks = 0","function webpackEmptyContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 18;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/models\n// module id = 18\n// module chunks = 0","module.exports = require(\"passport-github\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-github\"\n// module id = 19\n// module chunks = 0","const KoaRouter = require('koa-router');\nconst apiRouter = new KoaRouter({ prefix: '/api' });\nconst fs = require(\"fs\");\nconst path = require('path');\n\nconst controllerPath = path.join(__dirname, '../controllers');\n\nfs\n  .readdirSync(controllerPath)\n  .filter(function(file) {\n    return (file.indexOf(\".\") !== 0) && (file !== \"index.js\");\n  })\n  .forEach(function(file) {\n    let controllerClass = require(path.join(controllerPath, file));\n    let controller = new controllerClass();\n    for (let method of [ 'options', 'get', 'post', 'delete', 'put' ]) {\n      if (method in controller) {\n        apiRouter[method](controller.url, async (ctx, next) => {\n          return controller[method](ctx).then(next);\n        });\n      }\n    }\n  });\n\napiRouter.get('/logout', (ctx) => {\n  ctx.logout()\n  ctx.body = {\n    message: 'success'\n  }\n})\n\nmodule.exports = apiRouter.routes();\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/api.js","function webpackEmptyContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 21;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/lib\n// module id = 21\n// module chunks = 0"],"sourceRoot":""}