{"version":3,"sources":["webpack:///webpack/bootstrap 84d24e798cb82524e3aa","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///./server/models/index.js","webpack:///external \"path\"","webpack:///external \"dotenv\"","webpack:///external \"fs\"","webpack:///external \"koa-router\"","webpack:///./server/lib/publish/index.js","webpack:///./server/controllers/page.js","webpack:///./server/constants.js","webpack:///external \"koa-passport\"","webpack:///./server/index.js","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/lib/api.js","webpack:///external \"regenerator-runtime\"","webpack:///./server/controllers/changelogs.js","webpack:///external \"sequelize\"","webpack:///./server/models/changelog.js","webpack:///./server/models/pages.js","webpack:///./server/models/users.js","webpack:///./server/controllers/count.js","webpack:///./server/controllers/files.js","webpack:///external \"async-busboy\"","webpack:///./server/lib/publish/qiniu.js","webpack:///external \"lodash\"","webpack:///external \"qiniu\"","webpack:///./server/controllers/pages.js","webpack:///./server/controllers/publish.js","webpack:///external \"mkdirp\"","webpack:///external \"webshot\"","webpack:///./server/controllers/users.js","webpack:///external \"koa-session\"","webpack:///external \"koa-bodyparser\"","webpack:///./server/lib/passport.js","webpack:///external \"passport-github\"","webpack:///./nuxt.config.js","webpack:///./server/models/db.js"],"names":["require","config","fs","path","Sequelize","env","configDB","params","Object","assign","underscored","dialectOptions","ssl","define","timestamps","createdAt","updatedAt","logging","sequelize","url","database","username","password","db","forEach","md","model","name","keys","modelName","associate","ctx","id","models","pages","update","is_delete","where","changelog","create","action","page_id","items","create_by","state","user","body","message","findAll","result","page","status","JSON","parse","request","change","count","reduce","title","trim","stringify","length","__","VALUE_MAX_LENGTH","VALUE_TOO_LONG","attributes","changed","app","host","process","HOST","port","PORT","use","passport","initialize","session","router","get","authenticate","successRedirect","failureRedirect","routes","apiRoute","Promise","resolve","reject","res","on","nuxt","render","req","promise","then","catch","dev","builder","build","console","error","e","exit","sync","listen","log","err","Error","apiRouter","prefix","klass","controller","method","logout","query","size","parseInt","start","limit","$like","findAndCountAll","include","users","offset","order","total","data","rows","DataTypes","type","INTEGER","allowNull","primaryKey","autoIncrement","defaultValue","STRING","tableName","belongsTo","foreignKey","cover","is_publish","publish_at","DATE","NOW","hasOne","email","github_id","avatar","fn","literal","asyncBusboy","files","fields","upload","uploadRes","_","qiniu","QINIU_ACCESS_KEY","QINIU_SECRET_KEY","QINIU_BUCKET","QINIU_BASEURL","conf","ACCESS_KEY","SECRET_KEY","getUptoken","key","isEmpty","putPolicy","rs","PutPolicy","token","uptoken","localFile","extra","io","PutExtra","putFile","ret","hash","tasks","map","file","all","isPublish","findOrCreate","defaults","created","item","protocol","put","Date","now","dir","existsSync","mkdirp","shotUrl","options","screenSize","width","height","shotSize","userAgent","webshot","createReadStream","coverRes","serializeUser","done","deserializeUser","findById","GitHubStrategy","Strategy","clientID","GITHUB_CLIENT_ID","clientSecret","GITHUB_CLIENT_SECRET","callbackURL","GITHUB_CLIENT_CALLBACK_URL","accessToken","refreshToken","profile","cb","_json","avatar_url","spread","module","exports","srcDir","middleware","head","meta","charset","hid","content","link","rel","href","css","loading","color","vendor","extend","isClient","alias","join","__dirname","plugins","DATABASE_DIALECT","DATABASE_STORAGE","DATABASE_HOST","DATABASE_PORT","DATABASE_NAME","DATABASE_USER","DATABASE_PASSWORD","DATABASE_URL","base"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 84d24e798cb82524e3aa","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","require('dotenv').config();\nconst fs        = require(\"fs\");\nconst path      = require(\"path\");\nconst Sequelize = require('sequelize');\nconst env       = process.env.NODE_ENV || \"development\";\n// const config    = require('../../config/db.js')[env];\nimport configDB from './db.js';\nconst config = configDB[env];\n\nimport changelog from './changelog'\nimport pages from './pages'\nimport users from './users'\n\nconst params = Object.assign({\n  // 字段以下划线（_）来分割\n  underscored: true,\n  dialectOptions: {\n    ssl: false\n  },\n  define: {\n    timestamps: true,\n    createdAt: 'create_at',\n    updatedAt: 'update_at'\n  },\n  logging: false\n}, config);\n\nlet sequelize\n\nif (config.url) {\n  sequelize = new Sequelize(config.url, params);\n} else {\n  sequelize = new Sequelize(config.database, config.username, config.password, params);\n}\n\nlet db = {};\n\n[changelog, pages, users].forEach(function(md) {\n  var model = md(sequelize, Sequelize);\n  db[model.name] = model;\n});\n\nObject.keys(db).forEach(function(modelName) {\n  if (\"associate\" in db[modelName]) {\n    db[modelName].associate(db);\n  }\n});\n\ndb.sequelize = sequelize;\ndb.Sequelize = Sequelize;\n\nexport default db;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 5\n// module chunks = 0","import qiniu from './qiniu'\n// import opads from './opads'\n\nexport default qiniu;\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/publish/index.js","import __ from '../constants'\nimport models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/page/:id';\n  }\n\n  async delete(ctx) {\n    let { id } = ctx.params;\n\n    await models.pages.update(\n      {\n        is_delete: 1\n      },\n      {\n        where: {\n          id: id\n        }\n      }\n    );\n\n    await models.changelog.create({\n      action: 3,\n      page_id: id,\n      items: null,\n      create_by: ctx.state.user.id\n    });\n\n    ctx.body = {\n      message: \"Delete success\"\n    };\n  }\n\n  async get(ctx) {\n    let { id } = ctx.params;\n\n    let result = await models.pages.findAll(\n      {\n        where: {\n          is_delete: 0,\n          id: id\n        }\n      }\n    );\n\n    let page = result[0];\n    if (!page)\n      throw {\n        status: 404,\n        name: \"PAGES_NOT_FOUND\",\n        message: \"page is not found\"\n      };\n\n    try {\n      if (page.items) page.items = JSON.parse(page.items);\n      if (page.config) page.config = JSON.parse(page.config);\n    } catch (error) {\n      throw {\n        status: 500,\n        name: \"JSON_PARSE_ERROR\",\n        message: \"json parse error\"\n      };\n    }\n\n    ctx.body = page;\n  }\n\n  async put(ctx) {\n    let { id } = ctx.params;\n    let { body } = ctx.request;\n    let change = Object.create(null);\n    let count = [\"title\", \"config\", \"items\"].reduce((count, name) => {\n      if (!(name in body)) return count;\n      change[name] = body[name];\n      return count + 1;\n    }, 0);\n\n    if (count === 0)\n      throw {\n        status: 400,\n        name: \"ERR\",\n        message: \"require `title` or/and `items` in request body\"\n      };\n\n    change.title = change.title.trim();\n\n    if (!change.title)\n      throw { status: 400, name: \"ERROR_PARAMS\", message: \"Title 不能为空\" };\n\n    if (\"items\" in change) {\n      change.items = JSON.stringify(change.items);\n      if (change.items.length > __.VALUE_MAX_LENGTH) throw __.VALUE_TOO_LONG;\n    }\n    if (\"config\" in change) {\n      change.config = JSON.stringify(change.config);\n    }\n\n    let [page] = await models.pages.findAll({\n      attributes: ['is_delete', 'items'],\n      where: {\n        id: id\n      }\n    })\n\n    if (!page || page.is_delete)\n        throw {\n          status: 404,\n          name: \"PAGE_NOT_FOUND\",\n          message: \"page is not found\"\n        };\n\n    await models.pages.update(\n      change,\n      {\n        where: {\n          id: id\n        }\n      }\n    );\n\n    let changed = [\"title\", \"config\", \"items\"].reduce((changed, name) => {\n      return page[name] !== change[name] ? changed + 1 : changed;\n    }, 0);\n    if (changed > 0) {\n      await models.changelog.create({\n        action: 2,\n        page_id: id,\n        items: change.items,\n        create_by: ctx.state.user.id\n      });\n    }\n\n    ctx.body = {\n      message: \"Save success\"\n    };\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/page.js","export default {\n  VALUE_MAX_LENGTH: 10240,\n  VALUE_TOO_LONG: {\n                    status: 400,\n                    message: 'Value 不能大于 10240 个字符',\n                    name: 'VALUE_TOO_LONG'\n                  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/constants.js","module.exports = require(\"koa-passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-passport\"\n// module id = 9\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\nimport apiRoute from './lib/api'\nimport models from './models'\n\nconst app = new Koa()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\n\napp.keys = ['i-love-piper']\napp.use(require('koa-session')({}, app))\n\napp.use(require('koa-bodyparser')());\n// app.use(require('./lib/errorlog'));\n\n// authentication\nrequire('./lib/passport')\nconst passport = require('koa-passport')\napp.use(passport.initialize())\napp.use(passport.session())\n\nconst router = require('koa-router')()\n\nrouter.get('/auth/github',\n  passport.authenticate('github')\n)\n\nrouter.get('/auth/github/callback',\n  passport.authenticate('github', {\n    successRedirect: '/',\n    // TODO: login failure page\n    failureRedirect: '/login'\n  })\n)\n\napp.use(router.routes())\napp.use(apiRoute.routes())\n\napp.use(ctx => {\n  ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n\n  return new Promise((resolve, reject) => {\n    ctx.res.on('close', resolve)\n    ctx.res.on('finish', resolve)\n    nuxt.render(ctx.req, ctx.res, promise => {\n      // nuxt.render passes a rejected promise into callback on error.\n      promise.then(resolve).catch(reject)\n    })\n  })\n})\n\n// Import and Set Nuxt.js options\nlet config = require('../nuxt.config.js')\nconfig.dev = !(app.env === 'production')\n\n// Instantiate nuxt.js\nconst nuxt = new Nuxt(config)\n\n// Build in development\nif (config.dev) {\n  const builder = new Builder(nuxt)\n  builder.build().catch(e => {\n    console.error(e) // eslint-disable-line no-console\n    process.exit(1)\n  })\n}\n\nmodels.sequelize.sync().then(function(){\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}).catch(function(err){\n  console.error(new Error(err))\n});\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 12\n// module chunks = 0","import KoaRouter from 'koa-router'\nimport fs from 'fs'\nimport path from 'path'\n\nimport changelogs from '../controllers/changelogs'\nimport count from '../controllers/count'\nimport files from '../controllers/files'\nimport page from '../controllers/page'\nimport pages from '../controllers/pages'\nimport publish from '../controllers/publish'\nimport users from '../controllers/users'\n\nconst apiRouter = new KoaRouter({ prefix: '/api' });\n\n[changelogs, count, files, page, pages, publish, users].forEach(function(klass) {\n  let controller = new klass();\n  for (let method of [ 'options', 'get', 'post', 'delete', 'put' ]) {\n    if (method in controller) {\n      // apiRouter[method](controller.url, async (ctx) => {\n      //   if (ctx.isAuthenticated()) {\n      //     return await controller[method](ctx)\n      //   } else {\n      //     throw {\n      //       status: 401,\n      //       name: 'NOT_LOGIN',\n      //       message: 'not login'\n      //     }\n      //   }\n      // });\n      // TODO: ctx.isAuthenticated\n      apiRouter[method](controller.url, async (ctx) => await controller[method](ctx));\n    }\n  }\n});\n\napiRouter.get('/logout', (ctx) => {\n  ctx.logout()\n  ctx.body = {\n    message: 'success'\n  }\n})\n\nexport default apiRouter\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/api.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 14\n// module chunks = 0","import models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/changelogs';\n  }\n\n  async get(ctx) {\n    let { page, size, title, action } = ctx.query;\n    page = parseInt(page, 10)\n    size = parseInt(size, 10)\n    let start = (page - 1) * size;\n    let limit = size;\n    let where = {};\n    if (title) {\n      where['$page.title$'] = {\n        $like: `%${title}%`\n      }\n    }\n    if (action && action != 0) {\n      where['action'] = action\n    }\n\n    let result = await models.changelog.findAndCountAll({\n      attributes: ['action', 'create_at'],\n      include: [\n        {\n          model: models.pages,\n          attributes: ['title']\n        },\n        {\n          model: models.users,\n          attributes: ['name']\n        }\n      ],\n      offset: start,\n      limit: limit,\n      where: where,\n      order: [['create_at', 'DESC']]\n    });\n\n    ctx.body = {\n      total: result.count,\n      page: page,\n      size: size,\n      data: result.rows\n    }\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/changelogs.js","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 16\n// module chunks = 0","/* jshint indent: 2 */\n\nexport default function(sequelize, DataTypes) {\n  let changelog = sequelize.define('changelog', {\n    id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    action: {\n      type: DataTypes.INTEGER(4),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    page_id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false\n    },\n    items: {\n      type: DataTypes.STRING(10240),\n      allowNull: true,\n      defaultValue: ''\n    },\n    create_by: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      defaultValue: '0'\n    }\n  }, {\n    tableName: 'changelog'\n  });\n\n  changelog.associate = function(models) {\n    changelog.belongsTo(models.pages, {foreignKey: 'page_id'});\n    changelog.belongsTo(models.users, {foreignKey: 'create_by'});\n  }\n\n  return changelog;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/changelog.js","/* jshint indent: 2 */\n\nexport default function(sequelize, DataTypes) {\n  let pages = sequelize.define('pages', {\n    id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    title: {\n      type: DataTypes.STRING(64),\n      allowNull: false\n    },\n    cover: {\n      type: DataTypes.STRING(64),\n      allowNull: true,\n      defaultValue: ''\n    },\n    config: {\n      type: DataTypes.STRING(512),\n      allowNull: false,\n      defaultValue: ''\n    },\n    items: {\n      type: DataTypes.STRING(10240),\n      allowNull: false\n    },\n    create_by: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    is_publish: {\n      type: DataTypes.INTEGER(4),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    is_delete: {\n      type: DataTypes.INTEGER(4),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    publish_at: {\n      type: DataTypes.DATE,\n      allowNull: true,\n      defaultValue: sequelize.NOW\n    }\n  }, {\n    tableName: 'pages'\n  });\n\n  pages.associate = function(models) {\n    pages.hasOne(models.changelog, {foreignKey: 'page_id'});\n    pages.belongsTo(models.users, {foreignKey: 'create_by'});\n  }\n\n  return pages;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/pages.js","/* jshint indent: 2 */\n\nexport default function(sequelize, DataTypes) {\n  let users = sequelize.define('users', {\n    id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING(64),\n      allowNull: false\n    },\n    email: {\n      type: DataTypes.STRING(64),\n      allowNull: false\n    },\n    github_id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    avatar: {\n      type: DataTypes.STRING(64),\n      allowNull: true,\n      defaultValue: '',\n    }\n  }, {\n    tableName: 'users'\n  });\n\n  users.associate = function(models) {\n    users.hasOne(models.changelog, {foreignKey: 'create_by'});\n    users.hasOne(models.pages, {foreignKey: 'create_by'});\n  }\n\n  return users;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/users.js","import models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/count';\n  }\n\n  async get(ctx) {\n    let [result] = await models.pages.findAll({\n      attributes: [\n        [models.sequelize.fn('COUNT', models.sequelize.literal('CASE WHEN is_publish = 0 THEN 1 ELSE NULL END')), 'working'],\n        [models.sequelize.fn('COUNT', models.sequelize.literal('CASE WHEN is_publish = 1 THEN 1 ELSE NULL END')), 'published']\n      ],\n      where: {\n        is_delete: 0\n      }\n    })\n\n    ctx.body = result;\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/count.js","import asyncBusboy from 'async-busboy'\nimport upload from '../lib/publish'\n\nexport default class {\n  constructor() {\n    this.url = '/files';\n  }\n\n  async post(ctx) {\n    const {files, fields} = await asyncBusboy(ctx.req);\n\n    let uploadRes = await upload(files);\n\n    ctx.body = uploadRes\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/files.js","module.exports = require(\"async-busboy\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"async-busboy\"\n// module id = 23\n// module chunks = 0","require('dotenv').config();\nconst _ = require('lodash')\nconst qiniu = require('qiniu')\n\nlet {\n  QINIU_ACCESS_KEY,\n  QINIU_SECRET_KEY,\n  QINIU_BUCKET,\n  QINIU_BASEURL\n} = process.env;\n\nqiniu.conf.ACCESS_KEY = QINIU_ACCESS_KEY;\nqiniu.conf.SECRET_KEY = QINIU_SECRET_KEY;\n\nconst getUptoken = (key) => {\n  if (_.isEmpty(key)) return\n\n  const putPolicy = new qiniu.rs.PutPolicy(`${QINIU_BUCKET}:${key}`)\n  return putPolicy.token()\n}\n\nconst upload = (uptoken, localFile) => {\n\n  if (_.isEmpty(uptoken)) return\n\n  const extra = new qiniu.io.PutExtra()\n\n  return new Promise((resolve, reject) => {\n    qiniu.io.putFile(uptoken, localFile, localFile, extra, (err, ret) => {\n      if (!err) {\n        resolve({\n          hash: ret.hash,\n          key: ret.key,\n          url: `${QINIU_BASEURL}/${ret.key}`\n        })\n      } else {\n        console.log(\"upload error\", err, localFile)\n        reject(err)\n      }\n    })\n  })\n}\n\nexport default async (files) => {\n\n  if (\n    QINIU_ACCESS_KEY === 'YOUR QINIU AK' ||\n    QINIU_SECRET_KEY === 'YOUR QINIU SK' ||\n    QINIU_BUCKET === 'YOUR QINIU BUCKET' ||\n    QINIU_BASEURL === 'YOUR QINIU URL'\n    ) {\n    throw { status: 404, name: 'UPLOAD_ERROR_CONFIG', message: '请在 process.env 里配置 qiniu 上传相关的配置: QINIU_ACCESS_KEY/QINIU_SECRET_KEY/QINIU_BUCKET/QINIU_BASEURL' };\n  }\n\n  let tasks = files.map((file, key) => upload(getUptoken(file.path), file.path));\n\n  return await Promise.all(tasks);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/publish/qiniu.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"qiniu\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"qiniu\"\n// module id = 26\n// module chunks = 0","import __ from '../constants'\nimport models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/pages';\n  }\n\n  async get(ctx) {\n    let { page, size, title, isPublish } = ctx.query;\n    page = parseInt(page, 10)\n    size = parseInt(size, 10)\n    let start = (page - 1) * size;\n    let limit = size;\n    let where = {\n      is_delete: 0\n    };\n    if (title) {\n      where['title'] = {\n        $like: `%${title}%`\n      }\n    }\n    if (isPublish != -1) {\n      where['is_publish'] = isPublish\n    }\n    let result = await models.pages.findAndCountAll({\n      include: [\n        {\n          model: models.users,\n          attributes: ['name']\n        }\n      ],\n      offset: start,\n      limit: limit,\n      where: where,\n      order: [['create_at', 'DESC']]\n    });\n\n    ctx.body = {\n      total: result.count,\n      page: page,\n      size: size,\n      data: result.rows\n    };\n  }\n\n  async put(ctx) {\n    let { title = '', config = '', items = '' } = ctx.request.body;\n    title = title.trim();\n    if (!title) throw { status: 400, name: 'ERROR_PARAMS', message: 'Title 不能为空' };\n    items = JSON.stringify(items);\n    if (items.length > __.VALUE_MAX_LENGTH) throw __.VALUE_TOO_LONG;\n    config = JSON.stringify(config);\n\n    let [page, created] = await models.pages.findOrCreate({\n      where: {\n        is_delete: 0,\n        title: title\n      },\n      defaults: {\n        title: title,\n        config: config,\n        items: items,\n        create_by: ctx.state.user.id\n      }\n    });\n\n    if (page && !created) {\n      throw { status: 400, name: 'DUP', message: '记录已存在' };\n    }\n\n    await models.changelog.create({\n      action: 1,\n      page_id: page.id,\n      items: items,\n      create_by: ctx.state.user.id\n    })\n\n    ctx.body = {\n      message: 'Save success',\n      item: page\n    };\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/pages.js","import pageApi from './page'\nimport models from '../models'\nimport path from 'path'\nimport fs from 'fs'\nimport mkdirp from 'mkdirp'\nimport upload from '../lib/publish'\nimport webshot from 'webshot'\n\nconst protocol = 'http://'\n\nexport default class {\n  constructor() {\n    this.url = '/publish/:id';\n  }\n\n  async put(ctx) {\n    // save data first\n    await new pageApi().put(ctx)\n\n    let { id } = ctx.params;\n\n    let [page] = await models.pages.findAll({\n      where: {\n        is_delete: 0,\n        id: id\n      }\n    });\n\n    if (!page) throw { status: 404, name: 'PAGES_NOT_FOUND', message: 'page is not found' };\n\n    await models.pages.update({\n      is_publish: 1,\n      publish_at: Date.now()\n    }, {\n      where: {\n        id: id\n      }\n    })\n\n    await models.changelog.create({\n      action: 4,\n      page_id: id,\n      items: null,\n      create_by: ctx.state.user.id\n    });\n\n    const dir = `public/${id}`;\n\n    if (!fs.existsSync(dir)) {\n\n      mkdirp(dir, function (err) {\n        if (err) {\n          console.error(err)\n        }\n      });\n    }\n\n    try {\n      page.config = JSON.parse(page.config);\n      page.items = JSON.parse(page.items);\n    } catch(error) {\n      throw { status: 500, name: 'JSON_PARSE_ERROR', message: 'json parse error' }\n    };\n\n    let shotUrl = `http://127.0.0.1:3000/view/${id}`\n    \n    var options = {\n      screenSize: {\n        width: 375\n      , height: 375\n      }\n    , shotSize: {\n        width: 375\n      , height: 'all'\n      }\n    , userAgent: 'Mozilla/5.0 (iPhone; U; CPU iPhone OS 3_2 like Mac OS X; en-us)'\n        + ' AppleWebKit/531.21.20 (KHTML, like Gecko) Mobile/7B298g'\n    };\n\n    webshot(shotUrl, `${dir}/cover.png`, options, function(err) {\n      if(err) {\n        throw { status: 404, name: 'WEBSHOT_ERR', message: 'webshot failed' };\n      }\n\n      upload([fs.createReadStream(`${dir}/cover.png`)]).then((coverRes) => {\n        models.pages.update({\n          cover: protocol + coverRes[0].url\n        }, {\n          where: {\n            id: id\n          }\n        })\n      })\n    });\n\n    ctx.body = {\n      url: shotUrl\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/publish.js","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"webshot\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webshot\"\n// module id = 30\n// module chunks = 0","import models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/users';\n  }\n\n  async get(ctx) {\n    let users = await models.users.findAll();\n    ctx.body = users;\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/users.js","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 33\n// module chunks = 0","require('dotenv').config()\nconst passport = require('koa-passport')\nimport models from '../models'\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id)\n})\n\npassport.deserializeUser(async function(id, done) {\n  try {\n    const user = await models.users.findById(id)\n    done(null, user)\n  } catch(err) {\n    done(err)\n  }\n})\n\nconst GitHubStrategy = require('passport-github').Strategy;\npassport.use(new GitHubStrategy({\n    clientID: process.env.GITHUB_CLIENT_ID,\n    clientSecret: process.env.GITHUB_CLIENT_SECRET,\n    callbackURL: process.env.GITHUB_CLIENT_CALLBACK_URL\n  },\n  function(accessToken, refreshToken, profile, cb) {\n    let {\n      name,\n      email,\n      id,\n      avatar_url\n    } = profile._json;\n    models.users.findOrCreate({where: {github_id: id}, defaults: {\n      name: name,\n      email: email,\n      avatar: avatar_url\n    }}).spread((user, created) => cb(null, user)).catch(err => {\n      console.log(err)\n    })\n  }\n));\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/passport.js","module.exports = require(\"passport-github\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-github\"\n// module id = 35\n// module chunks = 0","const path = require('path')\n\nmodule.exports = {\n  srcDir: 'client/',\n  /*\n  ** Router config\n  */\n  router: {\n    middleware: [\n      'check-auth'\n    ]\n  },\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'Piper',\n    meta: [\n      { charset: 'utf-8' },\n      { hid: 'viewport', name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'A drag-and-drop mobile website builder base on Vue.' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n    '@/assets/main.css'\n  ],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n  ** Build\n  */\n  build: {\n    vendor: [\n      'axios',\n      'element-ui',\n      'interactjs',\n      'lodash',\n      'qr.js',\n      'feather-icons'\n    ],\n    extend (config, { dev, isClient }) {\n      config.resolve.alias['_variable.less'] = path.join(__dirname, './assets/skin/_variable.less'),\n      config.resolve.alias['_base.less'] = path.join(__dirname, './assets/skin/_base.less')\n    }\n  },\n  plugins: [\n    '@/plugins/filters.js',\n    '@/plugins/element-ui.js',\n    '@/plugins/axios-defaults'\n  ]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","require('dotenv').config();\n\nlet {\n  DATABASE_DIALECT = 'mysql',\n  DATABASE_STORAGE = './db.sqlite',\n  DATABASE_HOST = '127.0.0.1',\n  DATABASE_PORT = 3306,\n  DATABASE_NAME = 'piper',\n  DATABASE_USER,\n  DATABASE_PASSWORD,\n  DATABASE_URL\n} = process.env;\n\nlet base = {\n  \"username\": DATABASE_USER,\n  \"password\": DATABASE_PASSWORD,\n  \"database\": DATABASE_NAME,\n  \"host\": DATABASE_HOST,\n  \"port\": DATABASE_PORT,\n  \"dialect\": DATABASE_DIALECT,\n  \"storage\": DATABASE_STORAGE,\n  \"url\": DATABASE_URL\n};\n\nexport default {\n  \"development\": base,\n  \"test\": base,\n  \"production\": base\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/db.js"],"sourceRoot":""}