{"version":3,"sources":["webpack:///webpack/bootstrap dc354a49d77f603ecd87","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///./server/models/index.js","webpack:///external \"path\"","webpack:///external \"dotenv\"","webpack:///external \"fs\"","webpack:///external \"koa-router\"","webpack:///./server/lib/publish/index.js","webpack:///./server/controllers/page.js","webpack:///./server/constants.js","webpack:///external \"koa-passport\"","webpack:///./server/index.js","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/lib/api.js","webpack:///external \"regenerator-runtime\"","webpack:///./server/controllers/changelogs.js","webpack:///external \"sequelize\"","webpack:///./config/db.js","webpack:///./server/models/changelog.js","webpack:///./server/models/pages.js","webpack:///./server/models/users.js","webpack:///./server/controllers/count.js","webpack:///./server/controllers/files.js","webpack:///external \"async-busboy\"","webpack:///./server/lib/publish/qiniu.js","webpack:///external \"lodash\"","webpack:///external \"qiniu\"","webpack:///./server/controllers/pages.js","webpack:///./server/controllers/publish.js","webpack:///external \"co-views\"","webpack:///external \"child_process\"","webpack:///external \"mkdirp\"","webpack:///external \"webshot\"","webpack:///./server/controllers/users.js","webpack:///external \"koa-session\"","webpack:///external \"koa-bodyparser\"","webpack:///./server/lib/passport.js","webpack:///external \"passport-github\"","webpack:///./nuxt.config.js"],"names":["require","config","fs","path","Sequelize","env","configDB","params","Object","assign","underscored","dialectOptions","ssl","define","timestamps","createdAt","updatedAt","sequelize","url","database","username","password","db","forEach","md","model","name","keys","modelName","associate","ctx","id","models","pages","update","is_delete","where","changelog","create","action","page_id","items","create_by","state","user","body","message","findAll","result","page","status","JSON","parse","request","change","count","reduce","title","trim","stringify","length","__","VALUE_MAX_LENGTH","VALUE_TOO_LONG","attributes","changed","app","host","process","HOST","port","PORT","use","passport","initialize","session","router","get","authenticate","successRedirect","failureRedirect","routes","apiRoute","Promise","resolve","reject","res","on","nuxt","render","req","promise","then","catch","dev","builder","build","console","error","e","exit","sync","listen","log","err","Error","apiRouter","prefix","klass","controller","method","isAuthenticated","logout","query","size","parseInt","start","limit","$like","findAndCountAll","include","users","offset","order","total","data","rows","DATABASE_DIALECT","DATABASE_STORAGE","DATABASE_HOST","DATABASE_PORT","DATABASE_NAME","DATABASE_USER","DATABASE_PASSWORD","DATABASE_URL","base","DataTypes","type","INTEGER","allowNull","primaryKey","autoIncrement","defaultValue","STRING","tableName","belongsTo","foreignKey","cover","is_publish","publish_at","DATE","NOW","hasOne","email","github_id","avatar","fn","literal","asyncBusboy","files","fields","upload","uploadRes","_","qiniu","QINIU_ACCESS_KEY","QINIU_SECRET_KEY","QINIU_BUCKET","QINIU_BASEURL","conf","ACCESS_KEY","SECRET_KEY","getUptoken","key","isEmpty","putPolicy","rs","PutPolicy","token","uptoken","localFile","extra","io","PutExtra","putFile","ret","hash","tasks","map","file","all","isPublish","findOrCreate","defaults","created","item","pageApi","views","child_process","mkdirp","join","__dirname","ext","webshot","protocol","html","put","Date","now","dir","existsSync","writeFileSync","command","stdout","execSync","toString","packRes","errors","assets","createReadStream","shotUrl","filter","indexOf","options","screenSize","width","height","shotSize","userAgent","coverRes","serializeUser","done","deserializeUser","findById","GitHubStrategy","Strategy","clientID","GITHUB_CLIENT_ID","clientSecret","GITHUB_CLIENT_SECRET","callbackURL","GITHUB_CLIENT_CALLBACK_URL","accessToken","refreshToken","profile","cb","_json","avatar_url","spread","module","exports","srcDir","middleware","head","meta","charset","content","hid","link","rel","href","css","loading","color","vendor","extend","isClient","alias","plugins"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap dc354a49d77f603ecd87","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","require('dotenv').config();\nconst fs        = require(\"fs\");\nconst path      = require(\"path\");\nconst Sequelize = require('sequelize');\nconst env       = process.env.NODE_ENV || \"development\";\n// const config    = require('../../config/db.js')[env];\nimport configDB from '../../config/db.js';\nconst config = configDB[env];\n\nimport changelog from './changelog'\nimport pages from './pages'\nimport users from './users'\n\nconst params = Object.assign({\n  // 字段以下划线（_）来分割\n  underscored: true,\n  dialectOptions: {\n    ssl: false\n  },\n  define: {\n    timestamps: true,\n    createdAt: 'create_at',\n    updatedAt: 'update_at'\n  },\n  // logging: false\n}, config);\n\nlet sequelize\n\nif (config.url) {\n  sequelize = new Sequelize(config.url, params);\n} else {\n  sequelize = new Sequelize(config.database, config.username, config.password, params);\n}\n\nlet db = {};\n\n[changelog, pages, users].forEach(function(md) {\n  var model = md(sequelize, Sequelize);\n  db[model.name] = model;\n});\n\nObject.keys(db).forEach(function(modelName) {\n  if (\"associate\" in db[modelName]) {\n    db[modelName].associate(db);\n  }\n});\n\ndb.sequelize = sequelize;\ndb.Sequelize = Sequelize;\n\nexport default db;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 5\n// module chunks = 0","import qiniu from './qiniu'\n// import opads from './opads'\n\nexport default qiniu;\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/publish/index.js","import __ from '../constants'\nimport models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/page/:id';\n  }\n\n  async delete(ctx) {\n    let { id } = ctx.params;\n\n    await models.pages.update(\n      {\n        is_delete: 1\n      },\n      {\n        where: {\n          id: id\n        }\n      }\n    );\n\n    await models.changelog.create({\n      action: 3,\n      page_id: id,\n      items: null,\n      create_by: ctx.state.user.id\n    });\n\n    ctx.body = {\n      message: \"Delete success\"\n    };\n  }\n\n  async get(ctx) {\n    let { id } = ctx.params;\n\n    let result = await models.pages.findAll(\n      {\n        where: {\n          is_delete: 0,\n          id: id\n        }\n      }\n    );\n\n    let page = result[0];\n    if (!page)\n      throw {\n        status: 404,\n        name: \"PAGES_NOT_FOUND\",\n        message: \"page is not found\"\n      };\n\n    try {\n      if (page.items) page.items = JSON.parse(page.items);\n      if (page.config) page.config = JSON.parse(page.config);\n    } catch (error) {\n      throw {\n        status: 500,\n        name: \"JSON_PARSE_ERROR\",\n        message: \"json parse error\"\n      };\n    }\n\n    ctx.body = page;\n  }\n\n  async put(ctx) {\n    let { id } = ctx.params;\n    let { body } = ctx.request;\n    let change = Object.create(null);\n    let count = [\"title\", \"config\", \"items\"].reduce((count, name) => {\n      if (!(name in body)) return count;\n      change[name] = body[name];\n      return count + 1;\n    }, 0);\n\n    if (count === 0)\n      throw {\n        status: 400,\n        name: \"ERR\",\n        message: \"require `title` or/and `items` in request body\"\n      };\n\n    change.title = change.title.trim();\n\n    if (!change.title)\n      throw { status: 400, name: \"ERROR_PARAMS\", message: \"Title 不能为空\" };\n\n    if (\"items\" in change) {\n      change.items = JSON.stringify(change.items);\n      if (change.items.length > __.VALUE_MAX_LENGTH) throw __.VALUE_TOO_LONG;\n    }\n    if (\"config\" in change) {\n      change.config = JSON.stringify(change.config);\n    }\n\n    let [page] = await models.pages.findAll({\n      attributes: ['is_delete', 'items'],\n      where: {\n        id: id\n      }\n    })\n\n    if (!page || page.is_delete)\n        throw {\n          status: 404,\n          name: \"PAGE_NOT_FOUND\",\n          message: \"page is not found\"\n        };\n\n    await models.pages.update(\n      change,\n      {\n        where: {\n          id: id\n        }\n      }\n    );\n\n    let changed = [\"title\", \"config\", \"items\"].reduce((changed, name) => {\n      return page[name] !== change[name] ? changed + 1 : changed;\n    }, 0);\n    if (changed > 0) {\n      await models.changelog.create({\n        action: 2,\n        page_id: id,\n        items: change.items,\n        create_by: ctx.state.user.id\n      });\n    }\n\n    ctx.body = {\n      message: \"Save success\"\n    };\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/page.js","export default {\n  VALUE_MAX_LENGTH: 10240,\n  VALUE_TOO_LONG: {\n                    status: 400,\n                    message: 'Value 不能大于 10240 个字符',\n                    name: 'VALUE_TOO_LONG'\n                  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/constants.js","module.exports = require(\"koa-passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-passport\"\n// module id = 9\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\nimport apiRoute from './lib/api'\nimport models from './models'\n\nconst app = new Koa()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\n\napp.keys = ['i-love-piper']\napp.use(require('koa-session')({}, app))\n\napp.use(require('koa-bodyparser')());\n// app.use(require('./lib/errorlog'));\n\n// authentication\nrequire('./lib/passport')\nconst passport = require('koa-passport')\napp.use(passport.initialize())\napp.use(passport.session())\n\nconst router = require('koa-router')()\n\nrouter.get('/auth/github',\n  passport.authenticate('github')\n)\n\nrouter.get('/auth/github/callback',\n  passport.authenticate('github', {\n    successRedirect: '/',\n    // TODO: login failure page\n    failureRedirect: '/login'\n  })\n)\n\napp.use(router.routes())\napp.use(apiRoute.routes())\n\napp.use(ctx => {\n  ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n\n  return new Promise((resolve, reject) => {\n    ctx.res.on('close', resolve)\n    ctx.res.on('finish', resolve)\n    nuxt.render(ctx.req, ctx.res, promise => {\n      // nuxt.render passes a rejected promise into callback on error.\n      promise.then(resolve).catch(reject)\n    })\n  })\n})\n\n// Import and Set Nuxt.js options\nlet config = require('../nuxt.config.js')\nconfig.dev = !(app.env === 'production')\n\n// Instantiate nuxt.js\nconst nuxt = new Nuxt(config)\n\n// Build in development\nif (config.dev) {\n  const builder = new Builder(nuxt)\n  builder.build().catch(e => {\n    console.error(e) // eslint-disable-line no-console\n    process.exit(1)\n  })\n}\n\nmodels.sequelize.sync().then(function(){\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}).catch(function(err){\n  console.error(new Error(err))\n});\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 12\n// module chunks = 0","import KoaRouter from 'koa-router'\nimport fs from 'fs'\nimport path from 'path'\n\nimport changelogs from '../controllers/changelogs'\nimport count from '../controllers/count'\nimport files from '../controllers/files'\nimport page from '../controllers/page'\nimport pages from '../controllers/pages'\nimport publish from '../controllers/publish'\nimport users from '../controllers/users'\n\nconst apiRouter = new KoaRouter({ prefix: '/api' });\n\n[changelogs, count, files, page, pages, users].forEach(function(klass) {\n  let controller = new klass();\n  for (let method of [ 'options', 'get', 'post', 'delete', 'put' ]) {\n    if (method in controller) {\n      apiRouter[method](controller.url, async (ctx) => {\n        if (ctx.isAuthenticated()) {\n          return await controller[method](ctx)\n        } else {\n          throw {\n            status: 401,\n            name: 'NOT_LOGIN',\n            message: 'not login'\n          }\n        }\n      });\n    }\n  }\n});\n\napiRouter.get('/logout', (ctx) => {\n  ctx.logout()\n  ctx.body = {\n    message: 'success'\n  }\n})\n\nexport default apiRouter\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/api.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 14\n// module chunks = 0","import models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/changelogs';\n  }\n\n  async get(ctx) {\n    let { page, size, title, action } = ctx.query;\n    page = parseInt(page, 10)\n    size = parseInt(size, 10)\n    let start = (page - 1) * size;\n    let limit = size;\n    let where = {};\n    if (title) {\n      where['$page.title$'] = {\n        $like: `%${title}%`\n      }\n    }\n    if (action && action != 0) {\n      where['action'] = action\n    }\n\n    let result = await models.changelog.findAndCountAll({\n      attributes: ['action', 'create_at'],\n      include: [\n        {\n          model: models.pages,\n          attributes: ['title']\n        },\n        {\n          model: models.users,\n          attributes: ['name']\n        }\n      ],\n      offset: start,\n      limit: limit,\n      where: where,\n      order: [['create_at', 'DESC']]\n    });\n\n    ctx.body = {\n      total: result.count,\n      page: page,\n      size: size,\n      data: result.rows\n    }\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/changelogs.js","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 16\n// module chunks = 0","require('dotenv').config();\n\nlet {\n  DATABASE_DIALECT = 'mysql',\n  DATABASE_STORAGE = './db.sqlite',\n  DATABASE_HOST = '127.0.0.1',\n  DATABASE_PORT = 3306,\n  DATABASE_NAME = 'piper',\n  DATABASE_USER,\n  DATABASE_PASSWORD,\n  DATABASE_URL\n} = process.env;\n\nlet base = {\n  \"username\": DATABASE_USER,\n  \"password\": DATABASE_PASSWORD,\n  \"database\": DATABASE_NAME,\n  \"host\": DATABASE_HOST,\n  \"port\": DATABASE_PORT,\n  \"dialect\": DATABASE_DIALECT,\n  \"storage\": DATABASE_STORAGE,\n  \"url\": DATABASE_URL\n};\n\nexport default {\n  \"development\": base,\n  \"test\": base,\n  \"production\": base\n}\n\n\n\n// WEBPACK FOOTER //\n// ./config/db.js","/* jshint indent: 2 */\n\nexport default function(sequelize, DataTypes) {\n  let changelog = sequelize.define('changelog', {\n    id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    action: {\n      type: DataTypes.INTEGER(4),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    page_id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false\n    },\n    items: {\n      type: DataTypes.STRING(10240),\n      allowNull: true,\n      defaultValue: ''\n    },\n    create_by: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      defaultValue: '0'\n    }\n  }, {\n    tableName: 'changelog'\n  });\n\n  changelog.associate = function(models) {\n    changelog.belongsTo(models.pages, {foreignKey: 'page_id'});\n    changelog.belongsTo(models.users, {foreignKey: 'create_by'});\n  }\n\n  return changelog;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/changelog.js","/* jshint indent: 2 */\n\nexport default function(sequelize, DataTypes) {\n  let pages = sequelize.define('pages', {\n    id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    title: {\n      type: DataTypes.STRING(64),\n      allowNull: false\n    },\n    cover: {\n      type: DataTypes.STRING(64),\n      allowNull: true,\n      defaultValue: ''\n    },\n    config: {\n      type: DataTypes.STRING(512),\n      allowNull: false,\n      defaultValue: ''\n    },\n    items: {\n      type: DataTypes.STRING(10240),\n      allowNull: false\n    },\n    create_by: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    is_publish: {\n      type: DataTypes.INTEGER(4),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    is_delete: {\n      type: DataTypes.INTEGER(4),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    publish_at: {\n      type: DataTypes.DATE,\n      allowNull: true,\n      defaultValue: sequelize.NOW\n    }\n  }, {\n    tableName: 'pages'\n  });\n\n  pages.associate = function(models) {\n    pages.hasOne(models.changelog, {foreignKey: 'page_id'});\n    pages.belongsTo(models.users, {foreignKey: 'create_by'});\n  }\n\n  return pages;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/pages.js","/* jshint indent: 2 */\n\nexport default function(sequelize, DataTypes) {\n  let users = sequelize.define('users', {\n    id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING(64),\n      allowNull: false\n    },\n    email: {\n      type: DataTypes.STRING(64),\n      allowNull: false\n    },\n    github_id: {\n      type: DataTypes.INTEGER(11),\n      allowNull: false,\n      defaultValue: '0'\n    },\n    avatar: {\n      type: DataTypes.STRING(64),\n      allowNull: true,\n      defaultValue: '',\n    }\n  }, {\n    tableName: 'users'\n  });\n\n  users.associate = function(models) {\n    users.hasOne(models.changelog, {foreignKey: 'create_by'});\n    users.hasOne(models.pages, {foreignKey: 'create_by'});\n  }\n\n  return users;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/users.js","import models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/count';\n  }\n\n  async get(ctx) {\n    let [result] = await models.pages.findAll({\n      attributes: [\n        [models.sequelize.fn('COUNT', models.sequelize.literal('CASE WHEN is_publish = 0 THEN 1 ELSE NULL END')), 'working'],\n        [models.sequelize.fn('COUNT', models.sequelize.literal('CASE WHEN is_publish = 1 THEN 1 ELSE NULL END')), 'published']\n      ],\n      where: {\n        is_delete: 0\n      }\n    })\n\n    ctx.body = result;\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/count.js","import asyncBusboy from 'async-busboy'\nimport upload from '../lib/publish'\n\nexport default class {\n  constructor() {\n    this.url = '/files';\n  }\n\n  async post(ctx) {\n    const {files, fields} = await asyncBusboy(ctx.req);\n\n    let uploadRes = await upload(files);\n\n    ctx.body = uploadRes\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/files.js","module.exports = require(\"async-busboy\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"async-busboy\"\n// module id = 23\n// module chunks = 0","require('dotenv').config();\nconst _ = require('lodash')\nconst qiniu = require('qiniu')\n\nlet {\n  QINIU_ACCESS_KEY,\n  QINIU_SECRET_KEY,\n  QINIU_BUCKET,\n  QINIU_BASEURL\n} = process.env;\n\nqiniu.conf.ACCESS_KEY = QINIU_ACCESS_KEY;\nqiniu.conf.SECRET_KEY = QINIU_SECRET_KEY;\n\nconst getUptoken = (key) => {\n  if (_.isEmpty(key)) return\n\n  const putPolicy = new qiniu.rs.PutPolicy(`${QINIU_BUCKET}:${key}`)\n  return putPolicy.token()\n}\n\nconst upload = (uptoken, localFile) => {\n\n  if (_.isEmpty(uptoken)) return\n\n  const extra = new qiniu.io.PutExtra()\n\n  return new Promise((resolve, reject) => {\n    qiniu.io.putFile(uptoken, localFile, localFile, extra, (err, ret) => {\n      if (!err) {\n        resolve({\n          hash: ret.hash,\n          key: ret.key,\n          url: `${QINIU_BASEURL}/${ret.key}`\n        })\n      } else {\n        console.log(\"upload error\", err, localFile)\n        reject(err)\n      }\n    })\n  })\n}\n\nexport default async (files) => {\n\n  if (\n    QINIU_ACCESS_KEY === 'YOUR QINIU AK' ||\n    QINIU_SECRET_KEY === 'YOUR QINIU SK' ||\n    QINIU_BUCKET === 'YOUR QINIU BUCKET' ||\n    QINIU_BASEURL === 'YOUR QINIU URL'\n    ) {\n    throw { status: 404, name: 'UPLOAD_ERROR_CONFIG', message: '请在 process.env 里配置 qiniu 上传相关的配置: QINIU_ACCESS_KEY/QINIU_SECRET_KEY/QINIU_BUCKET/QINIU_BASEURL' };\n  }\n\n  let tasks = files.map((file, key) => upload(getUptoken(file.path), file.path));\n\n  return await Promise.all(tasks);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/publish/qiniu.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"qiniu\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"qiniu\"\n// module id = 26\n// module chunks = 0","import __ from '../constants'\nimport models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/pages';\n  }\n\n  async get(ctx) {\n    let { page, size, title, isPublish } = ctx.query;\n    page = parseInt(page, 10)\n    size = parseInt(size, 10)\n    let start = (page - 1) * size;\n    let limit = size;\n    let where = {\n      is_delete: 0\n    };\n    if (title) {\n      where['title'] = {\n        $like: `%${title}%`\n      }\n    }\n    if (isPublish != -1) {\n      where['is_publish'] = isPublish\n    }\n    let result = await models.pages.findAndCountAll({\n      include: [\n        {\n          model: models.users,\n          attributes: ['name']\n        }\n      ],\n      offset: start,\n      limit: limit,\n      where: where,\n      order: [['create_at', 'DESC']]\n    });\n\n    ctx.body = {\n      total: result.count,\n      page: page,\n      size: size,\n      data: result.rows\n    };\n  }\n\n  async put(ctx) {\n    let { title = '', config = '', items = '' } = ctx.request.body;\n    title = title.trim();\n    if (!title) throw { status: 400, name: 'ERROR_PARAMS', message: 'Title 不能为空' };\n    items = JSON.stringify(items);\n    if (items.length > __.VALUE_MAX_LENGTH) throw __.VALUE_TOO_LONG;\n    config = JSON.stringify(config);\n\n    let [page, created] = await models.pages.findOrCreate({\n      where: {\n        is_delete: 0,\n        title: title\n      },\n      defaults: {\n        title: title,\n        config: config,\n        items: items,\n        create_by: ctx.state.user.id\n      }\n    });\n\n    if (page && !created) {\n      throw { status: 400, name: 'DUP', message: '记录已存在' };\n    }\n\n    await models.changelog.create({\n      action: 1,\n      page_id: page.id,\n      items: items,\n      create_by: ctx.state.user.id\n    })\n\n    ctx.body = {\n      message: 'Save success',\n      item: page\n    };\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/pages.js","const pageApi = require('./page');\nconst models = require(\"../models\");\n\nconst path = require('path');\nconst views = require('co-views');\nconst child_process = require('child_process');\nconst fs = require('fs');\nconst mkdirp = require('mkdirp');\nconst render = views(path.join(__dirname, '../views'), { ext: 'ejs' });\nconst upload = require('../lib/publish');\n\nconst webshot = require('webshot');\n\nconst protocol = 'http://'\n\nexport default class {\n  constructor() {\n    this.url = '/publish/:id';\n  }\n\n  async get(ctx) {\n    let { id } = ctx.params;\n\n    let result = await models.pages.findAll({\n      where: {\n        is_delete: 0,\n        id: id\n      }\n    });\n\n    let page = result[0];\n    if (!page) throw { status: 404, name: 'PAGES_NOT_FOUND', message: 'page is not found' };\n    try { page.items = JSON.parse(page.items); } catch(error) {\n      throw { status: 500, name: 'JSON_PARSE_ERROR', message: 'json parse error' }\n    };\n\n    let html = await render('activity', { page: page });\n\n    ctx.body = html\n  }\n\n  async put(ctx) {\n    // save data first\n    await pageApi.put(ctx)\n\n    let { id } = ctx.params;\n\n    let [page] = await models.pages.findAll({\n      where: {\n        is_delete: 0,\n        id: id\n      }\n    });\n\n    if (!page) throw { status: 404, name: 'PAGES_NOT_FOUND', message: 'page is not found' };\n\n    await models.pages.update({\n      is_publish: 1,\n      publish_at: Date.now()\n    }, {\n      where: {\n        id: id\n      }\n    })\n\n    await models.changelog.create({\n      action: 4,\n      page_id: id,\n      items: null,\n      create_by: ctx.state.user.id\n    });\n\n    const dir = `public/${id}`;\n\n    if (!fs.existsSync(dir)) {\n\n      mkdirp(dir, function (err) {\n        if (err) {\n          console.error(err)\n        }\n      });\n    }\n\n    try {\n      page.config = JSON.parse(page.config);\n      page.items = JSON.parse(page.items);\n    } catch(error) {\n      throw { status: 500, name: 'JSON_PARSE_ERROR', message: 'json parse error' }\n    };\n\n    let html = await render('activity', { page: page });\n\n    await fs.writeFileSync(dir + `/index.html`, html, 'utf-8', {'flags': 'w+'});\n\n    const command = `NODE_ENV=production webpack --config ./build/webpack.publish.conf.js --env.id=${id} --hide-modules --json --verbose`;\n\n    const stdout = child_process.execSync(command).toString();\n\n    let packRes = JSON.parse(stdout);\n\n    if (packRes.errors.length == 0) {\n      let files = packRes.assets.map(item => {\n        return fs.createReadStream(dir + `/${item.name}`)\n      })\n      let uploadRes = await upload(files);\n\n      let shotUrl = uploadRes.filter(item => {\n        return item.url.indexOf('index.html') !== -1\n      })\n      shotUrl[0].url = protocol + shotUrl[0].url\n\n      var options = {\n        screenSize: {\n          width: 375\n        , height: 375\n        }\n      , shotSize: {\n          width: 375\n        , height: 'all'\n        }\n      , userAgent: 'Mozilla/5.0 (iPhone; U; CPU iPhone OS 3_2 like Mac OS X; en-us)'\n          + ' AppleWebKit/531.21.20 (KHTML, like Gecko) Mobile/7B298g'\n      };\n\n      webshot(shotUrl[0].url, `${dir}/cover.png`, options, function(err) {\n        if(err) {\n          throw { status: 404, name: 'WEBSHOT_ERR', message: 'webshot failed' };\n        }\n\n        upload([fs.createReadStream(`${dir}/cover.png`)]).then((coverRes) => {\n          models.pages.update({\n            cover: protocol + coverRes[0].url\n          }, {\n            where: {\n              id: id\n            }\n          })\n        })\n      });\n\n      ctx.body = shotUrl\n    } else {\n\n      ctx.body = packRes;\n    }\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/publish.js","module.exports = require(\"co-views\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"co-views\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"webshot\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webshot\"\n// module id = 32\n// module chunks = 0","import models from '../models'\n\nexport default class {\n  constructor() {\n    this.url = '/users';\n  }\n\n  async get(ctx) {\n    let users = await models.users.findAll();\n    ctx.body = users;\n  }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/users.js","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 35\n// module chunks = 0","require('dotenv').config()\nconst passport = require('koa-passport')\nimport models from '../models'\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id)\n})\n\npassport.deserializeUser(async function(id, done) {\n  try {\n    const user = await models.users.findById(id)\n    done(null, user)\n  } catch(err) {\n    done(err)\n  }\n})\n\nconst GitHubStrategy = require('passport-github').Strategy;\npassport.use(new GitHubStrategy({\n    clientID: process.env.GITHUB_CLIENT_ID,\n    clientSecret: process.env.GITHUB_CLIENT_SECRET,\n    callbackURL: process.env.GITHUB_CLIENT_CALLBACK_URL\n  },\n  function(accessToken, refreshToken, profile, cb) {\n    let {\n      name,\n      email,\n      id,\n      avatar_url\n    } = profile._json;\n    models.users.findOrCreate({where: {github_id: id}, defaults: {\n      name: name,\n      email: email,\n      avatar: avatar_url\n    }}).spread((user, created) => cb(null, user)).catch(err => {\n      console.log(err)\n    })\n  }\n));\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/passport.js","module.exports = require(\"passport-github\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-github\"\n// module id = 37\n// module chunks = 0","const path = require('path')\n\nmodule.exports = {\n  srcDir: 'client/',\n  /*\n  ** Router config\n  */\n  router: {\n    middleware: [\n      'check-auth'\n    ]\n  },\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'Piper',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'A drag-and-drop mobile website builder base on Vue.' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n    '@/assets/main.css'\n  ],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n  ** Build\n  */\n  build: {\n    vendor: [\n      'axios',\n      'element-ui',\n      'interactjs',\n      'lodash',\n      'qr.js',\n      'feather-icons'\n    ],\n    extend (config, { dev, isClient }) {\n      config.resolve.alias['_variable.less'] = path.join(__dirname, './assets/skin/_variable.less'),\n      config.resolve.alias['_base.less'] = path.join(__dirname, './assets/skin/_base.less')\n    }\n  },\n  plugins: [\n    '@/plugins/filters.js',\n    '@/plugins/element-ui.js',\n    '@/plugins/axios-defaults'\n  ]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}